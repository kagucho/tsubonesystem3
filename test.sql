/*
	Copyright (C) 2017  Kagucho <kagucho.net@gmail.com>

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Affero General Public License as published
	by the Free Software Foundation, either version 3 of the License, or (at
	your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Affero General Public License for more details.

	You should have received a copy of the GNU Affero General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

DROP TABLE IF EXISTS `club_member`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `club_member` (
	`id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
	`club` tinyint(3) unsigned NOT NULL,
	`member` smallint(5) unsigned NOT NULL,
	UNIQUE KEY `id` (`id`),
	KEY `club_member_club_constraint` (`club`),
	KEY `club_member_member_constraint` (`member`),
	CONSTRAINT `club_member_club_constraint` FOREIGN KEY (`club`) REFERENCES `clubs` (`id`),
	CONSTRAINT `club_member_member_constraint` FOREIGN KEY (`member`) REFERENCES `members` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `club_member` WRITE;
/*!40000 ALTER TABLE `club_member` DISABLE KEYS */;
INSERT INTO `club_member` VALUES (1,1,2),(3,2,1),(4,1,1);
/*!40000 ALTER TABLE `club_member` ENABLE KEYS */;
UNLOCK TABLES;

DROP TABLE IF EXISTS `clubs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clubs` (
	`id` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,
	`display_id` varchar(255) CHARACTER SET ascii COLLATE ascii_bin NOT NULL,
	`name` varchar(63) NOT NULL,
	`chief` smallint(5) unsigned NOT NULL,
	UNIQUE KEY `id` (`id`),
	UNIQUE KEY `display_id` (`display_id`),
	UNIQUE KEY `name` (`name`),
	KEY `chief_constraint` (`chief`),
	CONSTRAINT `chief_constraint` FOREIGN KEY (`chief`) REFERENCES `members` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `clubs` WRITE;
/*!40000 ALTER TABLE `clubs` DISABLE KEYS */;
INSERT INTO `clubs` VALUES (1,'prog','Prog部',2),(2,'web','Web部',1);
/*!40000 ALTER TABLE `clubs` ENABLE KEYS */;
UNLOCK TABLES;

DROP TABLE IF EXISTS `members`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `members` (
	`id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
	`display_id` varchar(255) CHARACTER SET ascii COLLATE ascii_bin NOT NULL,
	`flags` set('confirmed','ob') CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
	`password` binary(192) NOT NULL DEFAULT X'00000000000000000000000000000000000000000000000000000000',
	`nickname` varchar(63) NOT NULL,
	`realname` varchar(63) NOT NULL DEFAULT '',
	`entrance` year(4) NOT NULL DEFAULT '0000',
	`affiliation` varchar(63) NOT NULL DEFAULT '',
	`gender` varchar(63) NOT NULL DEFAULT '',
	`mail` varchar(255) CHARACTER SET ascii NOT NULL,
	`tel` varchar(255) CHARACTER SET ascii NOT NULL DEFAULT '',
	UNIQUE KEY `id` (`id`),
	UNIQUE KEY `display_id` (`display_id`),
	UNIQUE KEY `nickname` (`nickname`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4;
/*!40101 SET character_set_client = @saved_cs_client */;

/*
	nickname and realname are designed for backend/db.testQueryMembersCount.
	+----+--------------+-----------+----------+----------+
	| id | display_id   | nickname  | realname | entrance |
	+----+--------------+-----------+----------+----------+
	|  1 | 1stDisplayID | 1 !\%_1"# | $&\%_2'( |     1901 |
	|  2 | 2ndDisplayID | 2 !%_1"#  | $&\%_2'( |     1901 |
	|  3 | 3rdDisplayID | 3 !\%*1"# | $&\%_2'( |     1901 |
	|  4 | 4thDisplayID | 4 !)_1"#  | $&\%_2'( |     1901 |
	|  5 | 5thDisplayID | 5 !\%_1"# | $&%+2'(  |     1901 |
	|  6 | 6thDisplayID | 6 !\%_1"# | $&\%+2'( |     2155 |
	|  7 | 7thDisplayID | 7 !\%_1"# | $&,_2'(  |     1901 |
	+----+--------------+-----------+----------+----------+
	1. valid names which need to be escaped
	2. nickname lacking `\`
	3. one invalid character in nickname
	4. another invalid character in nickname
	5. realname lacking `\`
	6. one invalid character in realname
	7. another invalid character in realname
	8. different entrance
*/

LOCK TABLES `members` WRITE;
/*!40000 ALTER TABLE `members` DISABLE KEYS */;
INSERT INTO `members` VALUES
	(1,'1stDisplayID','',X'B361384F1EEB2AA9873D3ABDBC6C2E5F157C1B52F7A2CBD5B9454C1A0D8F6589591DCFEF5D2412EEA21327AEF68E3AD12B4A5D7EC3F78BEA3E38F64B0A56383EB520D59FC59911C145EF7AF33DB396BAFFB71DFB44F5FB996A83DA4B1C0E58C2C3BFCFD615711CF03B3884C6358B44D7EDE94B88E6D80AB46D589A996717700AB10302092E1750600E5DEAD0F5363C5100DFDDD26B4CC3B79EB1F7659ADA2638A2459DCB2B9D5CF50E6EC92B88FF6553ECDDFDC36A4BC82F0C719EA834F80FC2','1 !\\%_1\"#','$&\\%_2\'(',1901,'理学部第一部 数理情報科学科','男','1st@kagucho.net','000-000-001'),
	(2,'2ndDisplayID','',X'D00512B4FFCE3F85214524035C342574A9EDCE3E183EDC0F984394C2DBCAA189FBB2E3D6DD92F89AC3E8910DFED37906491D35AE1E10FEAF2AC81E8E90864B2522F4D150AE55728AF20C07882D267E14D93BFEE8C475C416AEE5EC141CB111C3132E8D39615D83BD807FC9B7AF030D92DC286E7D5C1A0490683B9DC287D759F355D8B2D64BD2B179A2935E4CAC13F5E41AEBD569392C6E5A1C37AE23191BC0A6451E1A29B9D399066A03140E45686A53DC00F7028F623A54C49C3B5769341424','2 !%_1\"#','$&\\%_2\'(',1901,'','女','','000-000-002'),
	(3,'3rdDisplayID','',X'C1079F08A7EE7CC10A65417264B3A731440F914DD1E48B464089C4D343AFBA36BB29B4B4B16414AB39E0449FC0A664DB8FF070376DE3D9A91520CD005301CCD1EE716B43996BF794F1F666253E1D5DEB2E1A29E02305C0F261B750C91973E6226EAE853434D696BD4B8B55BEE0765B30B77CE22D8AF2F49C2C2D993EEEC30B88D6F50C16B1DC1A8FE06A94CB15B91709C7A3524D3B4808ED4F6F27AF73084914E31CD16622F9E4058B785C032024508BFEC88A29980F8DB851A4971AE2B1B801','3 !\\%*1\"#','$&\\%_2\'(',1901,'','','','000-000-003'),
	(4,'4thDisplayID','',X'572880E787BF3BDD2B57D8F4BC954EC74AB24D86098B75AE690919783646B2EED0DD933DEE8217F7098EA4B30382FFF971738CC9F1C3F6DE06ECB90FA5D1E322345FC0DD9A6F3F2A5BE2F64A5F6529CCAAB44ED2CC68E04CE040283C8B2067D91E8F697D2C6157A4CE4D5D599833AFEDFCB3403EAB886F1912C6E12A135E98BBF887AE57FF968BC8E7E739AEAB96A34AF7DB1473499E3FD93AF55F3AF0BD606BAE9E05B732232B1096D730103DFF077C7F48F050B82089985474615DAC4D97C4','4 !)_1\"#','$&\\%_2\'(',1901,'','','',''),
	(5,'5thDisplayID','',X'A2DCF9BAF85EB4482162EFBE5F4DCF1ED86A76FB151487F64D18E44269646B71E5D10CD78A819FDB697F71FCE6EA2A8984383C044289C1104BA48F907CB28B91AC53381C1B12A0706D025E3C02C5E21F9F875A3D9AEB7DFCF2552D760CB0E9DEAE07C08FE509927ECEBC19D2F8222A8AC30AD280296BF95305A2904C5B6B0BFF576780089347453464F054C70659147E57CC15315FB1F98ABC2E44521DE90345BF228F519FE40C4BBDDB7C2DEDFEEFFF61783C7F6F22DCBE6C71C8B0400CACF1','5 !\\%_1\"#','$&%+2\'(',1901,'','','',''),
	(6,'6thDisplayID','',X'C851D880669E9F87F0EB34FD48139BA5B4995517589DB7B08824B1E8324DFFD57F5331120864EA2A95D5A146642F5922A75E9B2CE7222541551E78651573C2B1EFD80BDCED438E9BD668CF0275EC6D53C6795DE781280E5B160D250D284292D37B1E14E0BE91738CAA791B0E376D59CCD10340428DE08184CC60B0D83A7C4BD66F70883D4B9B36FA2CD4752FB3E3A65C983CD12743DC049AB9E9252B7D2EED08974A26CE7B917272DA52B08A3FC1D446366318D4893B2E390975F8101C981826','6 !\\%_1\"#','$&\\%+2\'(',2155,'','','',''),
	(7,'7thDisplayID','ob',X'D27C978903748D916372305367C5890DCE38309B1C621926DDCD68B148E4D22ECD38579B313A943E8BCF9E84FAF6CD6180BD29DD8DB4802DF7D62FD667E3D8DDAA554DD5A8B31BA37D32051323AC6A413CBBB5DAC3A06CB699E6E0CCCABF690710AA18956237EB5CF9413050BE57CBE2EC1517AE010CDA66BC44B6EE90313ED964C851F6E838C26B4BC6A02876B64EC764208E41C148B954B3975BDE3F4B09D8D349F8339CAB202AE8A9C82C208FCB160D5B90F5AC67CCFA11150FF38EAE6D32','7 !\\%_1\"#','$&,_2\'(',1901,'','','','');
/*!40000 ALTER TABLE `members` ENABLE KEYS */;
UNLOCK TABLES;

DROP TABLE IF EXISTS `officers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `officers` (
	`display_id` varchar(255) CHARACTER SET ascii COLLATE ascii_bin NOT NULL,
	`name` varchar(63) NOT NULL,
	`member` smallint(5) unsigned NOT NULL,
	`scope` set('management','privacy') CHARACTER SET ascii COLLATE ascii_bin NOT NULL,
	PRIMARY KEY (`display_id`),
	UNIQUE KEY `name` (`name`),
	KEY `member` (`member`),
	CONSTRAINT `officers_member_constraint` FOREIGN KEY (`member`) REFERENCES `members` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `officers` WRITE;
/*!40000 ALTER TABLE `officers` DISABLE KEYS */;
INSERT INTO `officers` VALUES ('president','局長',1,'management,privacy'),('vice','副局長',1,'privacy');
/*!40000 ALTER TABLE `officers` ENABLE KEYS */;
UNLOCK TABLES;

DROP TABLE IF EXISTS `parties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `parties` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(63) NOT NULL,
  `start` datetime NOT NULL,
  `end` datetime NOT NULL,
  `place` varchar(63) NOT NULL,
  `inviteds` varchar(63) NOT NULL,
  `due` datetime NOT NULL,
  `details` varchar(8192) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `parties` WRITE;
/*!40000 ALTER TABLE `parties` DISABLE KEYS */;
/*!40000 ALTER TABLE `parties` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
